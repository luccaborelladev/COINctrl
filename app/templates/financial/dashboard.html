{% extends "base.html" %}

{% block title %}Dashboard Financeiro - COINctrl{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                <h1 class="h2">üí∞ Dashboard Financeiro</h1>
                <div class="btn-toolbar mb-2 mb-md-0">
                    <div class="btn-group me-2">
                        <a href="{{ url_for('financial.new_transaction') }}" class="btn btn-success btn-sm">
                            ‚ûï Nova Transa√ß√£o
                        </a>
                        <a href="{{ url_for('financial.new_category') }}" class="btn btn-outline-primary btn-sm">
                            üè∑Ô∏è Nova Categoria
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Cards de Estat√≠sticas -->
    <div class="row mb-4">
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card shadow h-100 py-2" style="border-left: 4px solid #28a745;">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">Receitas</div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">
                                R$ {{ "%.2f"|format(totals.receitas|float) }}
                            </div>
                        </div>
                        <div class="col-auto">
                            <span class="text-success">üìà</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card shadow h-100 py-2" style="border-left: 4px solid #dc3545;">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-danger text-uppercase mb-1">Despesas</div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">
                                R$ {{ "%.2f"|format(totals.despesas|float) }}
                            </div>
                        </div>
                        <div class="col-auto">
                            <span class="text-danger">üìâ</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card shadow h-100 py-2" style="border-left: 4px solid '{% if totals.saldo >= 0 %}#28a745{% else %}#dc3545{% endif %}';">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold {% if totals.saldo >= 0 %}text-success{% else %}text-danger{% endif %} text-uppercase mb-1">Saldo</div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">
                                R$ {{ "%.2f"|format(totals.saldo|float) }}
                            </div>
                        </div>
                        <div class="col-auto">
                            <span class="{% if totals.saldo >= 0 %}text-success{% else %}text-danger{% endif %}">üí∞</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card shadow h-100 py-2" style="border-left: 4px solid #17a2b8;">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-info text-uppercase mb-1">Transa√ß√µes</div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">{{ total_transactions }}</div>
                        </div>
                        <div class="col-auto">
                            <span class="text-info">üìä</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- A√ß√µes R√°pidas e √öltimas Transa√ß√µes -->
    <div class="row">
        <!-- A√ß√µes R√°pidas -->
        <div class="col-xl-4 col-lg-5">
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">üõ†Ô∏è A√ß√µes R√°pidas</h6>
                </div>
                <div class="card-body">
                    <div class="list-group list-group-flush">
                        <a href="{{ url_for('financial.new_transaction') }}" class="list-group-item list-group-item-action">
                            <div class="d-flex w-100 justify-content-between">
                                <h6 class="mb-1">‚ûï Nova Transa√ß√£o</h6>
                                <small class="text-success">Receita/Despesa</small>
                            </div>
                            <p class="mb-1">Adicionar nova receita ou despesa</p>
                        </a>
                        
                        <a href="{{ url_for('financial.transactions') }}" class="list-group-item list-group-item-action">
                            <div class="d-flex w-100 justify-content-between">
                                <h6 class="mb-1">üìã Ver Transa√ß√µes</h6>
                                <small class="text-info">{{ total_transactions }} itens</small>
                            </div>
                            <p class="mb-1">Visualizar todas as transa√ß√µes</p>
                        </a>
                        
                        <a href="{{ url_for('financial.categories') }}" class="list-group-item list-group-item-action">
                            <div class="d-flex w-100 justify-content-between">
                                <h6 class="mb-1">üè∑Ô∏è Categorias</h6>
                                <small class="text-warning">{{ total_categories }} itens</small>
                            </div>
                            <p class="mb-1">Gerenciar categorias</p>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- √öltimas Transa√ß√µes -->
        <div class="col-xl-8 col-lg-7">
            <div class="card shadow mb-4">
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold text-primary">üìä √öltimas Transa√ß√µes</h6>
                    <a href="{{ url_for('financial.transactions') }}" class="btn btn-sm btn-outline-primary">Ver Todas</a>
                </div>
                <div class="card-body">
                    {% if recent_transactions %}
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Data</th>
                                        <th>Descri√ß√£o</th>
                                        <th>Categoria</th>
                                        <th>Tipo</th>
                                        <th>Valor</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for transaction in recent_transactions %}
                                    <tr>
                                        <td>{{ transaction.transaction_date.strftime('%d/%m/%Y') }}</td>
                                        <td>{{ transaction.description }}</td>
                                        <td>
                                            <span style="color: '{{ transaction.category.color }}'">
                                                {{ transaction.category.icon }} {{ transaction.category.name }}
                                            </span>
                                        </td>
                                        <td>
                                            <span class="badge {% if transaction.transaction_type.value == 'receita' %}bg-success{% else %}bg-danger{% endif %}">
                                                {{ 'üìà' if transaction.transaction_type.value == 'receita' else 'üìâ' }}
                                                {{ transaction.transaction_type.value.title() }}
                                            </span>
                                        </td>
                                        <td class="{% if transaction.transaction_type.value == 'receita' %}text-success{% else %}text-danger{% endif %}">
                                            <strong>{{ transaction.formatted_amount }}</strong>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <div class="text-center py-4">
                            <span style="font-size: 3rem;">üìÇ</span>
                            <p class="text-muted mt-3">Nenhuma transa√ß√£o encontrada.</p>
                            <a href="{{ url_for('financial.new_transaction') }}" class="btn btn-success">‚ûï Adicionar Primeira Transa√ß√£o</a>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}